<HTML>
<HEAD>
<TITLE> Kakadu Hyper-Doc (kds_metascope) </TITLE>
<STYLE TYPE="text/css">
<!--
.indented-text { padding-left: 20pt; }
-->
</STYLE>
</HEAD>
<BODY TEXT="#000000" LINK="#0000ff" BGCOLOR="#FFF491">
<P ALIGN="RIGHT">|<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#FuncS"> functions </A>||<A HREF="#VarS"> variables </A>|</P>
<H1><A NAME="ToP">kds_metascope [struct]</A></H1>

<P>[Declared in <A HREF="++++apps+k$er+kdu_serve+h.html">"../apps/kdu_server/kdu_serve.h"</A>]</P><P ALIGN="CENTER"><HR></P><H2><A NAME="SynopsiS">Synopsis</A></H2>
<DIV CLASS="indented-text">
<P>
Used to describe image regions and image entities to
which the metadata boxes in a particular 
<A HREF="kds$group.html">kds_metagroup</A> object relate, this object provides the information
necessary for 
<A HREF="kdu_serve.html">kdu_serve</A> to appropriately sequence metadata into a stream of
messages generated by the 
<A HREF="kdu_serve__gen$ncrements.html">kdu_serve::generate_increments</A> function, so that metadata is appropriately interleaved
with compressed imagery, and only the metadata which
is actually relevant to a client's interests need be
included.
</P><P>
 The information described in this object is designed
to facilitate efficient access to the metadata which
is actually required to satisfy a service request.
In particular, wherever a group has multiple sub-groups
(represented by placeholders), each with potentially
different scopes, the parent group's scope includes
the union of its descendants' scopes. This helps the
server to efficiently skip over irrelevant groups in
the tree.
</P>
</DIV>

<P ALIGN="CENTER"><HR></P><H2><A NAME="FuncS">Public Functions</A></H2><DIV CLASS="indented-text">
<P><A HREF="kds$scope__kds$metascope.html">kds_metascope</A></P>
</DIV>
<H2><A NAME="VarS">Public Variables</A></H2><DIV CLASS="indented-text">
<H4><A NAME="flags">flags</A> [<B>kdu_int32</B>]</H4><DIV CLASS="indented-text">
<P>
This word may contain any meaningful combination of
the following flags:
</P><UL><LI>
<A HREF="globals.html#KDS_METASCOPE_MANDATORY">KDS_METASCOPE_MANDATORY</A> &mdash; If this flag is present and the metadata matches
the current client request, the metadata must be sent
to the client, regardless of whether or not a "metareq"
request field has been used.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_IMAGE_MANDATORY">KDS_METASCOPE_IMAGE_MANDATORY</A> &mdash; Similar to the above flag, except the matching
metadata ceases to be mandatory if a "metareq" request
field specifies "metadata-only". Imagery related headers
generally belong to this category
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_INCLUDE_NEXT_SIBLING">KDS_METASCOPE_INCLUDE_NEXT_SIBLING</A> &mdash; If this flag is present, whenever the present
group is considered relevant to a client request, all
box headers in the next sibling group (boxes inside
the same superbox), if any, must also be considered
relevant to the client request. When applied to a group
of top-level boxes, this means that the next group
of top-level box headers must also be sent to the client.
The flag plays an important role in ensuring that a
file format reader will be able to determine whether
or not all necessary boxes have been received within
certain scopes. For example, within a JPX compositing
layer header box, all immediate sub-boxes must be seen
in order for a reader to determine whether or not any
other relevant boxes might be left to receive, which
might override defaults in a JP2 header box.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_INCLUDE_FIRST_SUBBOX">KDS_METASCOPE_INCLUDE_FIRST_SUBBOX</A> &mdash; If this flag is present, whenever the present
group is considered relevant to a client request, the
entire first sub-box is also considered relevant &mdash;
note that this first sub-box is guaranteed not to be
a placeholder in this case. This flag is used by JCLX
(Compositing Layer Extensions) and J2CX (Multiple Codestream)
boxes to indicate that their respective "info" sub-boxes
are required to meaningfully interpret the contents
of any current and subsequent boxes of the same type
at the same level of the file.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_LEAF">KDS_METASCOPE_LEAF</A> &mdash; If this flag is present, the following flags
(all commencing with the 
<B>HAS_</B> prefix) may be interpreted as final qualifiers, meaning
that the metagroup and all of its sub-groups must be
sent to the client so long as the client request matches
this scope. Otherwise, a scope match simply means that
one of the sub-groups might have a scope match.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_HAS_GLOBAL_DATA">KDS_METASCOPE_HAS_GLOBAL_DATA</A> &mdash; If present, either this metagroup or one of
its descendants (via placeholders) holds global metadata,
not associated with any particular image entity. Note
that this is not mutually exclusive with the following
flag, since a metagroup may have multiple sub-groups,
only some of which are global.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA">KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA</A> &mdash; If present, either this metagroup or one of
its descendants (via placeholders) holds metadata which
is associated with one or more specific image entities
(codestreams or compositing layers). In this case,
the 
<A HREF="kds$scope.html#entities">entities</A> member must be inspected to determine the identities
of these image entities.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_HAS_IMAGE_WIDE_DATA">KDS_METASCOPE_HAS_IMAGE_WIDE_DATA</A> &mdash; This flag may be present only if 
<A HREF="globals.html#KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA">KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA</A> is also present. It indicates that this group, or
one of its descendants (via placeholders), is associated
with the entirety of some image entity.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA">KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA</A> &mdash; This flag may be present only if 
<A HREF="globals.html#KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA">KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA</A> is also present. It indicates that this group, or
one of its descendants (via placeholders), is associated
with a specific spatial region of an image entity.
In this case, the spatial region is identified by the
<A HREF="kds$scope.html#region">region</A> member.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_IS_REGION_SPECIFIC_DATA">KDS_METASCOPE_IS_REGION_SPECIFIC_DATA</A> &mdash; This flag may be present only with 
<A HREF="globals.html#KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA">KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA</A>. It indicates either that this group contains an ROI
description box or that it contains an 
<B>asoc</B> box whose first sub-box is an ROI description box,
or that it is descended from a group of this form.
The difference between this condition and 
<A HREF="globals.html#KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA">KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA</A> is that the latter applies also to ancestors of boxes
which contain ROI description boxes.
</LI><LI>
<A HREF="globals.html#KDS_METASCOPE_IS_CONTEXT_SPECIFIC_DATA">KDS_METASCOPE_IS_CONTEXT_SPECIFIC_DATA</A> &mdash; This flag may be present only if 
<A HREF="globals.html#KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA">KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA</A> is also present. It indicates that the node is specifically
associated with one or more codestream contexts, rather
than just with codestreams. For a JPX source, this
flag is set to true if the group contains an 
<B>nlst</B> box whose contents include at least one compositing
layer index, regardless of whether codestream indices
are included as well. If this is true, all of the group's
descendants will have the same flag set and any containing
<B>asoc</B> box group which has the 
<B>nlst</B> as its first sub-box will also have the flag set.
</LI></UL>
</DIV>
<H4><A NAME="entities">entities</A> [<A HREF ="kds$ities.html">kds_image_entities</A>&nbsp;*]</H4><DIV CLASS="indented-text">
<P>
This member is never NULL, but it may contain no image
entities.
</P>
</DIV>
<H4><A NAME="max_discard_levels">max_discard_levels</A> [<B>kdu_int32</B>]</H4><DIV CLASS="indented-text">
<P>
Maximum number of discard levels for a codestream,
before spatially sensitive metadata in this group (or
any of its sub-groups) becomes irrelevant to the client.
This field is ignored if the 
<A HREF="globals.html#KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA">KDS_METASCOPE_HAS_IMAGE_SPECIFIC_DATA</A> flag is missing.
</P>
</DIV>
<H4><A NAME="region">region</A> [<A HREF ="kdu_dims.html">kdu_dims</A>]</H4><DIV CLASS="indented-text">
<P>
Ignored unless the 
<A HREF="globals.html#KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA">KDS_METASCOPE_HAS_REGION_SPECIFIC_DATA</A> flag is present. This member identifies the location
and dimensions of the region, expressed on the high
resolution canvas of the codestreams listed in the
<A HREF="kds$scope.html#entities">entities</A> list, where the position is expressed relative to
the upper left hand corner of the image region on this
canvas.
</P>
</DIV>
<H4><A NAME="sequence">sequence</A> [<B>kdu_int32</B>]</H4><DIV CLASS="indented-text">
<P>
This parameter determines the priority with which the
metadata should be sequenced by 
<A HREF="kdu_serve__gen$ncrements.html">kdu_serve::generate_increments</A> if the present scope is found to intersect with the
client's interests. This sequencing priority is expressed
relative to other metadata and also relative to compressed
image elements.
</P><P>
 Generally, metadata required to interpret imagery
is assigned a 
<A HREF="kds$scope.html#sequence">sequence</A> value of 0, while other non-region-specific metadata
is assigned a 
<A HREF="kds$scope.html#sequence">sequence</A> value of 
<B>KDS_MAX_METASCOPE_SEQUENCE</B> &mdash; it must be specifically requested by a client
in order to be sequenced with higher priority. Region-specific
content is assigned a 
<A HREF="kds$scope.html#sequence">sequence</A> value which is equal to
</P><UL><LI>
64 + log_2(region-cost) - log_2(region-area)
</LI></UL><P>
 Here, region-area is the area covered by the relevant
region-of-interest (may be significantly smaller than
<B>region.area()</B>), while region-cost is the number of bytes required
to signal the region-of-interest (typically the length
of a JPX ROI Description box. Considering that region
dimensions cannot exceed 2^32, log_2(region-area) &lt;=
64, so the 
<A HREF="kds$scope.html#sequence">sequence</A> value should always be positive and need never be
very large. In practice, it should never need to exceed
127, which is also the value of 
<B>KDS_MAX_METASCOPE_SEQUENCE</B>.
</P>
</DIV>
</DIV>
<P ALIGN="CENTER"><HR></P>
<P ALIGN="RIGHT">|<A HREF="#ToP"> top </A>||<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#FuncS"> functions </A>||<A HREF="#VarS"> variables </A>|</P>
</BODY>
</HTML>
